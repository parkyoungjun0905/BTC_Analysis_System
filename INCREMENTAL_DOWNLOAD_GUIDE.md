# 📈 CryptoQuant 증분 다운로드 & 6개월 데이터 시스템

## 🎯 시스템 개요

**목표**: CryptoQuant 1일 제한에 맞춰 효율적인 데이터 관리
- ✅ 로그인 시 1회만 다운로드
- ✅ 기존 CSV 이후 시점만 증분 다운로드
- ✅ AI에게는 최근 6개월 데이터만 전달

## 🔄 작동 원리

### 1️⃣ 증분 다운로드 로직
```
맥북 로그인 → LaunchAgent 실행 → 기존 CSV 확인
                ↓
    기존 CSV 없음          기존 CSV 있음
         ↓                     ↓
   전체 다운로드         최신 날짜 확인
                              ↓
                       오늘 = 최신날짜?
                         ↙        ↘
                      스킵      증분 다운로드
```

### 2️⃣ 6개월 데이터 필터링
```
전체 CSV 파일 → 6개월 전 날짜 계산 → 필터링 → AI 전달용 JSON
(누적 데이터)     (180일)         (최신만)    (1,157개 지표)
```

## 🛠️ 구현된 기능들

### CSV 다운로드 시스템 (`cryptoquant_downloader.py`)

| 기능 | 메서드 | 설명 |
|-----|--------|------|
| **최신 날짜 확인** | `get_latest_csv_date()` | 기존 CSV에서 가장 최신 날짜 찾기 |
| **데이터 병합** | `merge_csv_data()` | 새 데이터와 기존 데이터 중복 제거 병합 |
| **중복 방지** | `main()` | 같은 날 재실행 시 자동 스킵 |

### 데이터 통합 시스템 (`enhanced_data_collector.py`)

| 기능 | 메서드 | 설명 |
|-----|--------|------|
| **6개월 필터링** | `filter_last_6_months()` | CSV에서 최근 6개월 데이터만 추출 |
| **AI 전달 최적화** | `integrate_cryptoquant_csv()` | 6개월 제한 + 시계열 분석 |

## 📊 데이터 흐름

### 🔽 다운로드 단계
1. **로그인 감지** → LaunchAgent 실행
2. **기존 데이터 확인** → 최신 날짜 체크
3. **증분 다운로드** → 누락된 날짜만 수집
4. **데이터 병합** → 중복 제거 후 CSV 저장

### 🔼 AI 전달 단계  
1. **CSV 로드** → 전체 누적 데이터
2. **6개월 필터링** → 180일 전 ~ 현재
3. **시계열 분석** → 변화 추세 계산
4. **JSON 생성** → AI 분석용 구조화

## 🎯 사용 시나리오

### 📅 일반적인 하루
```
07:00 - 맥북 로그인
07:01 - CryptoQuant CSV 자동 다운로드 (어제 이후 데이터)
09:00 - 분석 실행 시 최근 6개월 데이터만 AI에게 전달
```

### 🔄 주말/휴가 후
```
월요일 로그인 → 금요일 이후 데이터 자동 수집
화요일 로그인 → 월요일 이후 데이터 자동 수집  
수요일 로그인 → 화요일 이후 데이터 자동 수집
```

## ⚙️ 설정 방법

### 1단계: 로그인 자동 다운로드 활성화
```bash
./setup_login_auto.sh
```

### 2단계: 첫 데이터 수집 (선택사항)
```bash
python3 cryptoquant_downloader.py
```

### 3단계: AI 분석 실행
```bash
python3 enhanced_data_collector.py
```

## 📋 검증 방법

### 증분 다운로드 테스트
```bash
./test_login_download.sh
```

### 6개월 필터링 확인
```bash
# JSON 결과 파일에서 data_range 확인
cat historical_data/btc_analysis_*.json | grep "data_range"
```

## 🔍 문제 해결

### CSV 파일이 비어있음
- **원인**: 첫 실행이거나 다운로드 실패
- **해결**: `python3 cryptoquant_downloader.py` 수동 실행

### 6개월 데이터가 부족함  
- **원인**: 최근에 시작해서 누적 데이터 부족
- **해결**: 시간이 지나면 자동으로 누적됨

### 중복 다운로드 감지 안됨
- **원인**: CSV 날짜 컬럼 형식 문제
- **해결**: CSV 구조 확인 후 `get_latest_csv_date()` 수정

## 💡 최적화 포인트

### 효율성
- ✅ 1일 1회만 다운로드 (API 제한 준수)
- ✅ 증분 수집으로 네트워크 절약
- ✅ 6개월 제한으로 AI 분석 속도 향상

### 안정성  
- ✅ 중복 방지 로직
- ✅ 데이터 병합 시 중복 제거
- ✅ 오류 발생 시 기존 데이터 보존

### 확장성
- ✅ 새로운 지표 자동 추가
- ✅ 날짜 형식 자동 감지
- ✅ 6개월 기간 쉽게 조정 가능

---

## 🎉 결과

**이제 CryptoQuant 1일 제한 하에서도:**
- 🔄 매일 자동으로 최신 데이터 수집
- 📊 누적된 과거 데이터 보존  
- 🤖 AI에게는 최적화된 6개월 데이터만 전달
- ⚡ 빠르고 효율적인 분석 가능

**완벽한 자동화 시스템 완성!** 🚀